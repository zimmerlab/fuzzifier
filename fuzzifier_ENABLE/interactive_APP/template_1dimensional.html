<!DOCTYPE html>
<html>
    <head>
        <title>Fuzzy Report</title>

        <style>
            .accordion {
                background-color: #eee;
                color: #444;
                cursor: pointer;
                padding: 18px;
                width: 1000px;
                text-align: left;
                border: none;
                outline: none;
                transition: 0.5s;
                font-size: 20px;
                font-weight: bold;
            }
            .active, .accordion:hover {
                background-color: #ccc;
            }
            .panel {
                padding: 0 18px;
                width: 1000px;
                background-color: white;
                border: black;
                display: none;
                overflow: hidden;
            }
            ul li {
                margin: 5px;
            }
            table, th, td {
                border: 1px solid black;
                border-collapse: collapse;
                column-width: 300px;
            }
            table { 
                margin-top: 50px;
                margin-bottom: 50px;
            }
            th, td {
                height: 40px;
            }
            tr {
                text-align: center;
                font-size: medium;
            }
            tr:nth-child(even) {
                background-color: #f1f1f1;
            }
            .center {
                display: block;
                margin-left: auto;
                margin-right: auto;
                width: 80%;
            }
            a {
                text-decoration: none;
                display: inline-block;
                padding: 8px 16px;
            }
            a:hover {
                background-color: #ddd;
                color: black;
            }
            .previous {
                background-color: #f1f1f1;
                color: black;
            }
            .next {
                background-color: #f1f1f1;
                color: black;
            }
            .round {
                border-radius: 50%;
            }
            img {
                margin-left: auto;
                margin-right: auto;
            }
        </style>
    </head>


    <body>
        <h1>Fuzzy Report</h1>
        <button class = "accordion">Input Overview</button>
        <div class = "panel">
            <ul>
                <li>The raw value matrix includes <strong>{{ numRows }}</strong> rows/features and <strong>{{ numCols }}</strong> columns/samples.</li>
                {% if addNoise %}
                {% if cutoffLeft and cutoffRight %}
                <li>Crisp values <strong>no larger than {{ minNoise }}</strong> and <strong>no smaller than {{ maxNoise }}</strong> are regarded as noise.</li>
                {% elif cutoffLeft %}
                <li>Crisp values <strong>no larger than {{ minNoise }}</strong> are regarded as noise.</li>
                {% elif cutoffRight %}
                <li>Crisp values <strong>no smaller than {{ maxNoise }}</strong> are regarded as noise.</li>
                {% endif %}
                {% endif %}
                <li>Additional categories are defined for specific values ({{ labelStr }}), while other raw values are fuzzified according to the fuzzy concept(s).</li>
            </ul>
            <table style = "margin-left: auto; margin-right: auto;">
                {% for item in crispStats %}
                <tr>
                    <td>{{ item.statement }}</td>
                    <td>{{ item.percentage }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>
        <br>

        {% if pctCompleted > 0.99 %}
        <button class = "accordion">Fuzzy Concept(s) <span style = "color: green; font-size: 28px;">&#9787;</span></button>
        {% elif pctCompleted > 0.75 %}
        <button class = "accordion">Fuzzy Concept(s) <span style = "color: gold; font-size: 28px;">&#9787;</span></button>
        {% else %}
        <button class = "accordion">Fuzzy Concept(s) <span style = "color: crimson; font-size: 28px;">&#9787;</span></button>
        {% endif %}
        <div class = "panel">
            <ul>
                {% if conceptStats[-1].value == "per feature" %}
                <li>One fuzzy concept is defined for each feature in the raw value matrix, using the same parameters for derivation.</li>
                {% else %}
                <li>One fuzzy concept is defined for all raw values in the matrix.</li>
                {% endif %}
                <li>In this fuzzification, the fuzzy values of <strong>{{ "{:.2%}".format (pctCompleted) }}</strong> fuzzified raw values can sum up to 1.</li>
            </ul>
            <table style = "margin-left: auto; margin-right: auto;">
                {% for item in conceptStats %}
                <tr>
                    <td>{{ item.statement }}</td>
                    <td>{{ item.value }}</td>
                </tr>
                {% endfor %}
            </table>
            <br>
            <img src = "{{ conceptPlot }}" class = "center">
        </div>
        <br>

        <button class = "accordion">Main Fuzzy Values and Main Fuzzy Sets</button>
        <div class = "panel">
            <ul>
                <li>The main fuzzy value is the highest fuzzy value for one raw value.</li>
                <li>The fuzzy set with the main fuzzy value is then its main fuzzy set.</li>
                <li>The percentage of raw values in each main fuzzy set is defined as the cardinality.</li>
            </ul>
            <img src = "{{ summaryFV }}" class = "center">
        </div>
        <br/>

        {% if pctClear > 0.5 %}
        <button class = "accordion">Fuzzy Classification <span style = "color: green; font-size: 28px;">&#9787;</span></button>
        {% elif pctClear > 0.25 %}
        <button class = "accordion">Fuzzy Classification <span style = "color: gold; font-size: 28px;">&#9787;</span></button>
        {% else %}
        <button class = "accordion">Fuzzy Classification <span style = "color: crimson; font-size: 28px;">&#9787;</span></button>
        {% endif %}
        <div class = "panel">
            <ul>
                <li>The Gini impurity is modified to quantify separation of clusters based on the fuzzy concept.</li>
                <ul>
                    <li>Gini impurity = 0: All clusters belong to the same fuzzy set.</li>
                    <li>Gini impurity = 1: All clusters may belong to different fuzzy sets.</li>
                </ul>
                <li><strong>{{ "{:.2%}".format (pctClear) }}</strong> fuzzified raw values have <strong>maximal Gini impurity > 0.5</strong>, assuming that they are clearly assigned to one fuzzy set.</li>
            </ul>
            <img src = "{{ impurityPlot }}" class = "center">
        </div>
        <br>

        <button class = "accordion">Cluster-Specific Features</button>
        <div class = "panel">
            <ul>
                <li>Assume a feature is specific in some clusters, then it is expected to be one level more lowly or highly expressed than in other clusters in comparison to a base level.</li>
                <li>This expression level is represented by the fuzzy sets here.</li>
                <li>In this fuzzification, <strong>{{ numSpecific }}</strong> cluster-specific features have been found with base level {{ baseLevel }}, where</li>
                    <ul>
                        {% if maxNum == 1 %}
                        <li>each of these features is specific in <strong>no more than {{ maxNum }} cluster</strong>,</li>
                        {% else %}
                        <li>each of these features is specific in <strong>no more than {{ maxNum }} clusters</strong>,</li>
                        {% endif %}
                        <li><strong>no less than {{ "{:.1%}".format (minPct) }}</strong> of the samples have their main fuzzy values in the highest level,</li>
                        <li>this average main membership is <strong>no lower than 0.6</strong> over all samples in the corresponding clusters.</li>
                    </ul>
            </ul>
            <span style = "margin: 10px"></span>
            <a href = "#" class = "previous round" id = "previous">&#8249;</a>
            <a href = "#" class = "next round" id = "next">&#8250;</a>
            <br>
            <img src = "{{ firstDot }}" id = "markers" class = "center">
        </div>
        <br>


        <script>
            var acc = document.getElementsByClassName ("accordion");
            for (var i = 0; i < acc.length; i++)
            {
                acc[i].addEventListener ("click", function ()
                {
                    this.classList.toggle ("active");
                    var panel = this.nextElementSibling;
                    if (panel.style.display === "block")
                    {
                        panel.style.display = "none";
                    }
                    else
                    {
                        panel.style.display = "block";
                    }
                });
            }

            var idx = 0;
            document.getElementById ("previous").onclick = function ()
            {
                idx--;
                var imgSRC = document.getElementById ("markers").src.split ("_").slice (0, -1).join ("_");
                imgSRC = imgSRC.concat ("_", 50 * idx + 1, ".png"); console.log (imgSRC);
                var dummy = new Image (); dummy.src = imgSRC;
                if (dummy.complete)
                {
                    document.getElementById ("markers").src = imgSRC;
                }
                else
                {
                    dummy.onload = () => { document.getElementById ("markers").src = imgSRC; };
                    dummy.onerror = () => { idx++; };
                }
            };
            document.getElementById ("next").onclick = function ()
            {
                idx++;
                var imgSRC = document.getElementById ("markers").src.split ("_").slice (0, -1).join ("_");
                imgSRC = imgSRC.concat ("_", 50 * idx + 1, ".png"); console.log (imgSRC);
                var dummy = new Image (); dummy.src = imgSRC;
                if (dummy.complete)
                {
                    document.getElementById ("markers").src = imgSRC;
                }
                else
                {
                    dummy.onload = () => { document.getElementById ("markers").src = imgSRC; };
                    dummy.onerror = () => { idx--; };
                }
            };
        </script>
    </body>
</html>
